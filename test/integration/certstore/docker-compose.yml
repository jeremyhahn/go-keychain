services:
  certstore-integration-test:
    build:
      context: ../../..
      dockerfile: test/integration/certstore/Dockerfile
    environment:
      - GO_TEST_TIMEOUT=10m
    volumes:
      - ../../../:/workspace
    working_dir: /workspace
    command: >
      sh -c "go test -v -tags=integration
      -timeout=10m
      -coverprofile=/tmp/coverage.out
      ./test/integration/certstore/... &&
      go tool cover -func=/tmp/coverage.out"
