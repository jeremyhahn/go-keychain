# FROST CLI Usage Guide

This document covers all CLI commands for FROST threshold signing operations.

## Command Overview

```
keychain frost <command> [options]

Commands:
  keygen      Generate FROST key packages (trusted dealer)
  import-dkg  Import key package from external DKG
  list        List FROST keys
  info        Show key details
  delete      Delete FROST key
  sign        Interactive signing (orchestrated mode)
  round1      Generate nonces/commitments (explicit mode)
  round2      Generate signature share (explicit mode)
  aggregate   Aggregate signature shares
  verify      Verify FROST signature
```

## Key Generation

### keygen - Generate FROST Keys

Generate new FROST key packages using the trusted dealer model.

```bash
keychain frost keygen [options]
```

**Options:**

| Option | Description | Default |
|--------|-------------|---------|
| `--algorithm`, `-a` | Ciphersuite algorithm | `FROST-Ed25519-SHA512` |
| `--threshold`, `-t` | Minimum signers required (M) | 2 |
| `--total`, `-n` | Total participants (N) | 3 |
| `--participants`, `-p` | Comma-separated participant IDs | Required |
| `--key-id` | Custom key identifier | Auto-generated |
| `--output`, `-o` | Output directory for key packages | Current directory |
| `--secret-backend` | Backend for secret storage | Config default |
| `--distribute` | Distribute key packages to participants | false |

**Examples:**

```bash
# Generate 3-of-5 Ed25519 keys
keychain frost keygen \
  --algorithm FROST-Ed25519-SHA512 \
  --threshold 3 \
  --total 5 \
  --participants "alice,bob,charlie,dave,eve" \
  --output ./keys/

# Generate 2-of-3 P-256 keys (FIPS compliant)
keychain frost keygen \
  --algorithm FROST-P256-SHA256 \
  --threshold 2 \
  --total 3 \
  --participants "signer1,signer2,signer3" \
  --key-id production-signing-key

# Generate keys with TPM storage for secrets
keychain frost keygen \
  --threshold 3 \
  --total 5 \
  --participants "node1,node2,node3,node4,node5" \
  --secret-backend tpm2
```

**Output:**

```
Generated FROST key: my-frost-key
  Algorithm:   FROST-Ed25519-SHA512
  Threshold:   3 of 5
  Participants:
    1. alice
    2. bob
    3. charlie
    4. dave
    5. eve

Key packages written to:
  ./keys/alice.json
  ./keys/bob.json
  ./keys/charlie.json
  ./keys/dave.json
  ./keys/eve.json

Group public key: 0x04a8b3c4d5e6f7...
```

### import-dkg - Import External DKG Key Package

Import a key package generated by an external DKG protocol.

```bash
keychain frost import-dkg [options]
```

**Options:**

| Option | Description | Default |
|--------|-------------|---------|
| `--package`, `-p` | Path to key package file | Required |
| `--key-id` | Custom key identifier | From package |
| `--secret-backend` | Backend for secret storage | Config default |

**Examples:**

```bash
# Import key package from external DKG
keychain frost import-dkg \
  --package ./dkg-output/my-share.json \
  --key-id imported-key

# Import with TPM storage
keychain frost import-dkg \
  --package ./dkg-output/my-share.json \
  --secret-backend tpm2
```

## Key Management

### list - List FROST Keys

List all FROST keys managed by this node.

```bash
keychain frost list [options]
```

**Options:**

| Option | Description | Default |
|--------|-------------|---------|
| `--format`, `-f` | Output format (table, json, yaml) | table |
| `--verbose`, `-v` | Show detailed information | false |

**Examples:**

```bash
# List all keys
keychain frost list

# List with details
keychain frost list --verbose

# Output as JSON
keychain frost list --format json
```

**Output:**

```
KEY ID                  ALGORITHM              THRESHOLD  CREATED
my-frost-key            FROST-Ed25519-SHA512   3/5        2025-01-15 10:30:00
production-key          FROST-P256-SHA256      2/3        2025-01-10 14:22:00
backup-key              FROST-Ed25519-SHA512   4/7        2025-01-05 09:15:00
```

### info - Show Key Details

Display detailed information about a FROST key.

```bash
keychain frost info <key-id> [options]
```

**Options:**

| Option | Description | Default |
|--------|-------------|---------|
| `--format`, `-f` | Output format (table, json, yaml) | table |
| `--show-public-key` | Display group public key | false |

**Examples:**

```bash
# Show key info
keychain frost info my-frost-key

# Show with public key
keychain frost info my-frost-key --show-public-key

# Output as JSON
keychain frost info my-frost-key --format json
```

**Output:**

```
Key ID:        my-frost-key
Algorithm:     FROST-Ed25519-SHA512
Threshold:     3 of 5
Created:       2025-01-15 10:30:00
Secret Backend: tpm2

Participants:
  1. alice (this node)
  2. bob
  3. charlie
  4. dave
  5. eve

Group Public Key:
  0x04a8b3c4d5e6f7890123456789abcdef...
```

### delete - Delete FROST Key

Delete a FROST key and all associated data.

```bash
keychain frost delete <key-id> [options]
```

**Options:**

| Option | Description | Default |
|--------|-------------|---------|
| `--force`, `-f` | Skip confirmation prompt | false |

**Examples:**

```bash
# Delete with confirmation
keychain frost delete my-frost-key

# Force delete
keychain frost delete my-frost-key --force
```

## Signing Operations

### sign - Orchestrated Signing

Interactive signing that coordinates with other participants automatically.

```bash
keychain frost sign [options]
```

**Options:**

| Option | Description | Default |
|--------|-------------|---------|
| `--key-id`, `-k` | Key identifier | Required |
| `--message`, `-m` | Message to sign (string) | - |
| `--message-file` | File containing message | - |
| `--message-hex` | Message as hex string | - |
| `--output`, `-o` | Output file for signature | stdout |
| `--format` | Signature format (raw, hex, base64) | raw |
| `--timeout` | Timeout for coordination | 60s |

**Examples:**

```bash
# Sign a string message
keychain frost sign \
  --key-id my-frost-key \
  --message "Hello, FROST!" \
  --output signature.bin

# Sign a file
keychain frost sign \
  --key-id my-frost-key \
  --message-file document.pdf \
  --output document.pdf.sig

# Sign with hex output
keychain frost sign \
  --key-id my-frost-key \
  --message "Transaction data" \
  --format hex
```

### round1 - Generate Nonces (Explicit Mode)

Generate nonces and commitments for the first round of explicit signing.

```bash
keychain frost round1 [options]
```

**Options:**

| Option | Description | Default |
|--------|-------------|---------|
| `--key-id`, `-k` | Key identifier | Required |
| `--output`, `-o` | Output file for nonce package | Required |
| `--session-id` | Session identifier | Auto-generated |

**Examples:**

```bash
# Generate nonces
keychain frost round1 \
  --key-id my-frost-key \
  --output round1-alice.json

# With custom session ID
keychain frost round1 \
  --key-id my-frost-key \
  --session-id "signing-session-001" \
  --output round1-alice.json
```

**Output File (round1-alice.json):**

```json
{
  "participant_id": 1,
  "session_id": "signing-session-001",
  "commitments": {
    "hiding": "0x04a8b3c4...",
    "binding": "0x05d6e7f8..."
  }
}
```

### round2 - Generate Signature Share (Explicit Mode)

Generate a signature share using collected commitments.

```bash
keychain frost round2 [options]
```

**Options:**

| Option | Description | Default |
|--------|-------------|---------|
| `--key-id`, `-k` | Key identifier | Required |
| `--message`, `-m` | Message to sign | - |
| `--message-file` | File containing message | - |
| `--message-hex` | Message as hex string | - |
| `--nonces` | This participant's nonce package | Required |
| `--commitments`, `-c` | Comma-separated commitment files | Required |
| `--output`, `-o` | Output file for signature share | Required |

**Examples:**

```bash
# Generate signature share
keychain frost round2 \
  --key-id my-frost-key \
  --message "Hello, FROST!" \
  --nonces round1-alice.json \
  --commitments round1-alice.json,round1-bob.json,round1-charlie.json \
  --output share-alice.json

# Sign file content
keychain frost round2 \
  --key-id my-frost-key \
  --message-file document.pdf \
  --nonces round1-alice.json \
  --commitments round1-alice.json,round1-bob.json,round1-charlie.json \
  --output share-alice.json
```

**Output File (share-alice.json):**

```json
{
  "participant_id": 1,
  "session_id": "signing-session-001",
  "signature_share": "0x1a2b3c4d..."
}
```

### aggregate - Aggregate Signature Shares

Combine signature shares into a final FROST signature.

```bash
keychain frost aggregate [options]
```

**Options:**

| Option | Description | Default |
|--------|-------------|---------|
| `--key-id`, `-k` | Key identifier | Required |
| `--message`, `-m` | Original message | - |
| `--message-file` | File containing message | - |
| `--message-hex` | Message as hex string | - |
| `--commitments`, `-c` | Comma-separated commitment files | Required |
| `--shares`, `-s` | Comma-separated signature share files | Required |
| `--output`, `-o` | Output file for signature | Required |
| `--format` | Signature format (raw, hex, base64) | raw |
| `--verify` | Verify signature after aggregation | true |

**Examples:**

```bash
# Aggregate shares
keychain frost aggregate \
  --key-id my-frost-key \
  --message "Hello, FROST!" \
  --commitments round1-alice.json,round1-bob.json,round1-charlie.json \
  --shares share-alice.json,share-bob.json,share-charlie.json \
  --output signature.bin

# Aggregate with hex output
keychain frost aggregate \
  --key-id my-frost-key \
  --message "Hello, FROST!" \
  --commitments round1-alice.json,round1-bob.json,round1-charlie.json \
  --shares share-alice.json,share-bob.json,share-charlie.json \
  --output signature.hex \
  --format hex
```

**Output:**

```
Aggregating 3 signature shares...
Signature verified successfully!
Signature written to: signature.bin
```

## Verification

### verify - Verify FROST Signature

Verify a FROST signature against the group public key.

```bash
keychain frost verify [options]
```

**Options:**

| Option | Description | Default |
|--------|-------------|---------|
| `--key-id`, `-k` | Key identifier | Required |
| `--message`, `-m` | Original message | - |
| `--message-file` | File containing message | - |
| `--message-hex` | Message as hex string | - |
| `--signature`, `-s` | Signature file | Required |
| `--signature-hex` | Signature as hex string | - |
| `--public-key` | Group public key (if key-id not available) | - |

**Examples:**

```bash
# Verify with key ID
keychain frost verify \
  --key-id my-frost-key \
  --message "Hello, FROST!" \
  --signature signature.bin

# Verify file signature
keychain frost verify \
  --key-id my-frost-key \
  --message-file document.pdf \
  --signature document.pdf.sig

# Verify with explicit public key
keychain frost verify \
  --public-key 0x04a8b3c4d5e6f7... \
  --message "Hello, FROST!" \
  --signature-hex 0x1a2b3c4d...
```

**Output:**

```
Signature verification: PASSED
  Key ID:    my-frost-key
  Algorithm: FROST-Ed25519-SHA512
  Message:   Hello, FROST!
```

## Complete Workflow Examples

### Example 1: Simple 3-of-5 Signing

```bash
# Step 1: Generate keys (run once by dealer)
keychain frost keygen \
  --threshold 3 \
  --total 5 \
  --participants "alice,bob,charlie,dave,eve" \
  --output ./keys/

# Step 2: Distribute key packages to participants
# (manual or automated distribution)

# Step 3: Each participant generates nonces (run on each node)
# Alice:
keychain frost round1 --key-id my-key --output round1-alice.json
# Bob:
keychain frost round1 --key-id my-key --output round1-bob.json
# Charlie:
keychain frost round1 --key-id my-key --output round1-charlie.json

# Step 4: Collect commitments and sign (each participant)
# Alice:
keychain frost round2 \
  --key-id my-key \
  --message "Sign this transaction" \
  --nonces round1-alice.json \
  --commitments round1-alice.json,round1-bob.json,round1-charlie.json \
  --output share-alice.json

# Bob:
keychain frost round2 \
  --key-id my-key \
  --message "Sign this transaction" \
  --nonces round1-bob.json \
  --commitments round1-alice.json,round1-bob.json,round1-charlie.json \
  --output share-bob.json

# Charlie:
keychain frost round2 \
  --key-id my-key \
  --message "Sign this transaction" \
  --nonces round1-charlie.json \
  --commitments round1-alice.json,round1-bob.json,round1-charlie.json \
  --output share-charlie.json

# Step 5: Aggregate (any participant or coordinator)
keychain frost aggregate \
  --key-id my-key \
  --message "Sign this transaction" \
  --commitments round1-alice.json,round1-bob.json,round1-charlie.json \
  --shares share-alice.json,share-bob.json,share-charlie.json \
  --output final-signature.bin

# Step 6: Verify (anyone with public key)
keychain frost verify \
  --key-id my-key \
  --message "Sign this transaction" \
  --signature final-signature.bin
```

### Example 2: Bitcoin/Ethereum Compatible Signing

```bash
# Generate secp256k1 keys for blockchain compatibility
keychain frost keygen \
  --algorithm FROST-secp256k1-SHA256 \
  --threshold 2 \
  --total 3 \
  --participants "cold,warm,hot" \
  --key-id btc-multisig

# Sign transaction hash
keychain frost sign \
  --key-id btc-multisig \
  --message-hex "0xabcdef1234567890..." \
  --format hex
```

### Example 3: Document Signing Workflow

```bash
# Generate P-256 keys for FIPS compliance
keychain frost keygen \
  --algorithm FROST-P256-SHA256 \
  --threshold 2 \
  --total 3 \
  --participants "legal,finance,exec" \
  --key-id contract-signing

# Sign a PDF document
keychain frost sign \
  --key-id contract-signing \
  --message-file contract.pdf \
  --output contract.pdf.sig

# Verify the signature
keychain frost verify \
  --key-id contract-signing \
  --message-file contract.pdf \
  --signature contract.pdf.sig
```

## Exit Codes

| Code | Description |
|------|-------------|
| 0 | Success |
| 1 | General error |
| 2 | Invalid arguments |
| 3 | Key not found |
| 4 | Signature verification failed |
| 5 | Insufficient shares |
| 6 | Nonce reuse detected |
| 7 | Backend error |
| 8 | Timeout |

## Environment Variables

| Variable | Description |
|----------|-------------|
| `KEYCHAIN_CONFIG` | Path to keychain config file |
| `KEYCHAIN_FROST_ALGORITHM` | Default algorithm |
| `KEYCHAIN_FROST_THRESHOLD` | Default threshold |
| `KEYCHAIN_FROST_BACKEND` | Default secret backend |
