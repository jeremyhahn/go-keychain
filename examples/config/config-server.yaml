# Example configuration for unified go-keychain server
# Supports all protocols: Unix socket (local), REST, gRPC, QUIC, MCP
#
# By default, keychaind only listens on Unix socket for local IPC.
# This example enables all protocols for demonstration purposes.

server:
  host: 0.0.0.0
  rest_port: 8443
  grpc_port: 9443
  quic_port: 8444
  mcp_port: 9444

# Protocol settings
# Unix socket is enabled by default for local CLI communication.
# Enable network protocols only when remote access is required.
protocols:
  unix: true    # Local Unix socket (default: true)
  rest: true    # REST/HTTP API (enable for remote access)
  grpc: true    # gRPC API (enable for remote access)
  quic: true    # QUIC/HTTP3 API (enable for remote access)
  mcp: true     # MCP JSON-RPC API (enable for AI/LLM integration)

# Unix socket configuration
unix:
  socket_path: /var/run/keychain/keychain.sock
  socket_mode: "0660"

logging:
  level: info  # debug, info, warn, error
  format: json # json, text

tls:
  enabled: true
  cert_file: /etc/keychain/server.crt
  key_file: /etc/keychain/server.key
  ca_file: /etc/keychain/ca.crt

  # Client certificate verification (mTLS)
  client_auth: require_and_verify  # none, request, require, verify, require_and_verify
  client_cas:
    - /etc/keychain/client-ca.crt

  # TLS version
  min_version: TLS1.2
  max_version: TLS1.3
  prefer_server_ciphers: true

auth:
  enabled: true
  type: mtls  # noop, apikey, mtls, jwt
  mtls: true

ratelimit:
  enabled: true
  requests_per_min: 1000

metrics:
  enabled: true
  path: /metrics
  port: 9090

health:
  enabled: true
  path: /health

storage:
  backend: file
  path: /var/lib/keychain/metadata

# Default backend for key operations
default_backend: pkcs8

backends:
  pkcs8:
    enabled: true
    path: /var/lib/keychain/keys

  # Uncomment to enable additional backends

  # tpm2:
  #   enabled: true
  #   device_path: /dev/tpmrm0

  # pkcs11:
  #   enabled: true
  #   library: /usr/lib/softhsm/libsofthsm2.so
  #   token_label: keychain-token
  #   pin: 1234

  # awskms:
  #   enabled: true
  #   region: us-east-1
  #   access_key_id: ${AWS_ACCESS_KEY_ID}
  #   secret_access_key: ${AWS_SECRET_ACCESS_KEY}

  # gcpkms:
  #   enabled: true
  #   project_id: my-project
  #   location: global
  #   key_ring: keychain
  #   credentials_file: /etc/keychain/gcp-credentials.json

  # azurekv:
  #   enabled: true
  #   vault_url: https://my-vault.vault.azure.net/
  #   tenant_id: ${AZURE_TENANT_ID}
  #   client_id: ${AZURE_CLIENT_ID}
  #   client_secret: ${AZURE_CLIENT_SECRET}

  # vault:
  #   enabled: true
  #   address: https://vault.example.com:8200
  #   token: ${VAULT_TOKEN}
  #   mount_path: keychain
